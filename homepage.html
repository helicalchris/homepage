<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Homepage</title>
    <meta name="description" content="AI-Generated Personal Homepage with OpenWebUI Design">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1A1A1A">
    <link rel="manifest" href="manifest.json">
    
    <script>
        // AI-GENERATED: This code was created to be maintained and modified by AI systems
        
        /**
         * Configuration Settings
         * These settings control core application behavior and should not be modified via UI
         */
        const CONFIG = {
            // Application Identity
            APP_ID: 'homepage-app-f7e8d9c2-a1b3-4c5d-e6f7-8g9h0i1j2k3l',
            SITE_INFO: {
                title: 'Personal Homepage',
                version: '1.0.0',
                author: 'AI Assistant',
                copyright: '2025',
                github: 'https://github.com/username/homepage'
            },
            
            // UI Customization
            UI_TEXT: {
                appTitle: 'Homepage',
                appSubtitle: 'Personal Link Manager'
            },
            
            // Portainer Integration Settings
            PORTAINER: {
                hostname: 'localhost',
                port: 9000,
                apiKey: 'ptr_your-api-key-here',
                endpoint: 1,
                pollingFrequency: 30000 // 30 seconds
            },
            
            // Security Settings
            ENCRYPTION: {
                passphrase: 'whisper-mountain-keyboard' // Three random words for basic encryption
            },
            
            // UI Settings
            UI: {
                cardsPerPage: 50,
                searchDelay: 300
            }
        };
    </script>
    
    <style>
        /* AI-GENERATED: CSS with OpenWebUI Design Principles */
        
        /* CSS Variables for Theme Management */
        :root {
            /* Light Mode Palette */
            --bg-primary-light: #FFFFFF;
            --bg-secondary-light: #F8F8F8;
            --text-primary-light: #2A2A2A;
            --text-secondary-light: #666666;
            --border-light: #E0E0E0;
            
            /* Dark Mode Palette */
            --bg-primary-dark: #1A1A1A;
            --bg-secondary-dark: #2A2A2A;
            --text-primary-dark: #FFFFFF;
            --text-secondary-dark: #E0E0E0;
            --border-dark: #404040;
            
            /* Accent Colors */
            --accent-color: #3B82F6;
            --accent-hover: #2563EB;
            --success-color: #10B981;
            --error-color: #EF4444;
            --warning-color: #F59E0B;
            
            /* Spacing and Layout */
            --sidebar-width: 280px;
            --border-radius: 8px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        /* Theme Application */
        [data-theme="light"] {
            --bg-primary: var(--bg-primary-light);
            --bg-secondary: var(--bg-secondary-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --border-color: var(--border-light);
        }
        
        [data-theme="dark"] {
            --bg-primary: var(--bg-primary-dark);
            --bg-secondary: var(--bg-secondary-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --border-color: var(--border-dark);
        }
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            overflow-x: hidden;
        }
        
        /* Layout Structure */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .sidebar-header {
            margin-bottom: 32px;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .app-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Navigation Menu */
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 8px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .nav-link:hover {
            background-color: var(--bg-primary);
        }
        
        .nav-link.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 24px;
            min-height: 100vh;
        }
        
        /* Header Controls */
        .content-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 32px;
            gap: 16px;
        }
        
        .search-container {
            flex: 1;
            max-width: 400px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-hover);
        }
        
        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--bg-primary);
        }
        
        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        /* Card Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        /* Link Cards */
        .link-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .link-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 8px;
        }
        
        .card-favicon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            border-radius: 4px;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }
        
        .card-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--text-secondary);
        }
        
        .card-status.online {
            background-color: var(--success-color);
        }
        
        .card-status.offline {
            background-color: var(--error-color);
        }
        
        .card-url {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            word-break: break-all;
        }
        
        .card-expanded {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }
        
        .card-field {
            margin-bottom: 12px;
        }
        
        .card-field label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .card-field input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .card-field input:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: var(--bg-primary);
            border-radius: var(--border-radius);
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox {
            width: 16px;
            height: 16px;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        /* Context Menu */
        .context-menu {
            position: fixed;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 8px 0;
            z-index: 1500;
            min-width: 160px;
        }
        
        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .context-menu-item:hover {
            background-color: var(--bg-secondary);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: var(--transition);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 16px;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .content-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-container {
                max-width: none;
            }
        }
        
        /* Card Expansion */
        .card-expandable {
            cursor: pointer;
        }
        
        .card-expand-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--transition);
        }
        
        .card-expand-btn:hover {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .card-expanded-content {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }
        
        .card-expanded-content.show {
            display: block;
        }
        
        .card-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .card-info-actions {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .card-info-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            font-size: 12px;
            transition: var(--transition);
        }
        
        .card-info-btn:hover {
            background-color: var(--bg-primary);
            color: var(--accent-color);
        }
        
        .card-info-label {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .card-info-value {
            color: var(--text-primary);
        }
        
        /* Sitemap Styles */
        .sitemap-section {
            margin-bottom: 24px;
        }
        
        .sitemap-section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .sitemap-section-icon {
            padding: 4px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .sitemap-links {
            columns: 3;
            column-gap: 24px;
            column-fill: balance;
        }
        
        .sitemap-link {
            display: block;
            padding: 6px 12px;
            margin-bottom: 4px;
            border-radius: 4px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
            break-inside: avoid;
            cursor: pointer;
        }
        
        .sitemap-link:hover {
            background-color: var(--bg-secondary);
        }
        
        .sitemap-link.favorite {
            position: relative;
        }
        
        .sitemap-link.favorite::after {
            content: '‚≠ê';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
        }
        
        @media (max-width: 768px) {
            .sitemap-links {
                columns: 1;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1200px) {
            .sitemap-links {
                columns: 2;
            }
        }
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-4 {
            margin-bottom: 16px;
        }
        
        .favorite-star {
            color: var(--warning-color);
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- AI-GENERATED: Main Application Structure -->
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="app-title" id="appTitle">Homepage</h1>
                <p class="app-subtitle" id="appSubtitle">Personal Link Manager</p>
            </div>
            
            <ul class="nav-menu" id="navMenu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="favorites">
                        <span class="nav-icon" style="background-color: #F59E0B;">‚≠ê</span>
                        Favorites
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="sitemap">
                        <span class="nav-icon" style="background-color: #10B981;">üó∫Ô∏è</span>
                        Sitemap
                    </a>
                </li>
            </ul>
            
            <div style="margin-top: 32px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 14px; color: var(--text-secondary); font-weight: 600;">SECTIONS</h3>
                    <button class="btn-icon btn-secondary" id="editSidebarBtn" onclick="toggleSidebarEdit()" title="Edit Sections">
                        ‚úèÔ∏è
                    </button>
                </div>
                <ul class="nav-menu" id="sectionsMenu">
                    <!-- Sections will be dynamically populated -->
                </ul>
                <button class="btn btn-secondary hidden" id="addSectionBtn" style="width: 100%; margin-top: 16px;" onclick="showAddSectionModal()">
                    + Add Section
                </button>
            </div>
            
            <div style="margin-top: auto; padding-top: 32px;">
                <div class="header-controls">
                    <button class="btn-icon btn-secondary" onclick="toggleTheme()" title="Toggle Theme">
                        üåô
                    </button>
                    <button class="btn-icon btn-secondary" onclick="showSettingsModal()" title="Settings">
                        ‚öôÔ∏è
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <header class="content-header">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search links..." id="searchInput">
                </div>
                <div class="header-controls">
                    <button class="btn btn-secondary" id="editModeBtn" onclick="toggleEditMode()">Edit</button>
                    <button class="btn btn-primary hidden" id="addLinkBtn" onclick="showAddLinkModal()">+ Add Link</button>
                </div>
            </header>
            
            <div id="pageContent">
                <!-- Dynamic content will be loaded here -->
            </div>
        </main>
    </div>
    
    <!-- Modals will be dynamically created -->
    
    <script>
        // AI-GENERATED: This code was created to be maintained and modified by AI systems
        
        /**
         * Application State Management
         * Centralizes all application state and provides reactive updates
         */
        class AppState {
            constructor() {
                this.currentPage = 'favorites';
                this.currentSection = null;
                this.editMode = false;
                this.sidebarEditMode = false;
                this.searchQuery = '';
                this.theme = this.detectSystemTheme();
                this.data = this.loadData();
                this.containerStatuses = new Map();
                this.pollingInterval = null;
                this.expandedCards = new Set();
                
                this.init();
            }
            
            /**
             * Initialize application state and start background processes
             */
            init() {
                this.applyTheme();
                this.updateUIText();
                this.startContainerPolling();
                this.setupEventListeners();
                this.render();
            }
            
            /**
             * Update UI text elements with configured values
             */
            updateUIText() {
                document.getElementById('appTitle').textContent = CONFIG.UI_TEXT.appTitle;
                document.getElementById('appSubtitle').textContent = CONFIG.UI_TEXT.appSubtitle;
            }
            
            /**
             * Detect system theme preference
             * @returns {string} 'dark' or 'light'
             */
            detectSystemTheme() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            
            /**
             * Load application data from localStorage with fallback to sample data
             * @returns {Object} Application data structure
             */
            loadData() {
                try {
                    const stored = localStorage.getItem(`${CONFIG.APP_ID}-data`);
                    if (stored) {
                        return JSON.parse(stored);
                    }
                } catch (error) {
                    console.error('Failed to load data from localStorage:', error);
                }
                
                // Return sample data for initial setup
                return this.getSampleData();
            }
            
            /**
             * Save application data to localStorage
             */
            saveData() {
                try {
                    localStorage.setItem(`${CONFIG.APP_ID}-data`, JSON.stringify(this.data));
                    this.showNotification('Data saved successfully', 'success');
                } catch (error) {
                    console.error('Failed to save data to localStorage:', error);
                    this.showNotification('Failed to save data', 'error');
                }
            }
            
            /**
             * Generate sample data for initial application state
             * @returns {Object} Sample data structure
             */
            getSampleData() {
                return {
                    sections: [
                        { id: 'admin', name: 'Admin', icon: '‚öôÔ∏è', color: '#EF4444' },
                        { id: 'ai', name: 'AI Tools', icon: 'ü§ñ', color: '#8B5CF6' },
                        { id: 'tools', name: 'Development', icon: 'üõ†Ô∏è', color: '#10B981' },
                        { id: 'lab', name: 'Laboratory', icon: 'üß™', color: '#F59E0B' }
                    ],
                    links: [
                        {
                            id: this.generateId(),
                            name: 'Portainer',
                            url: 'https://portainer.io',
                            section: 'admin',
                            favorite: true,
                            username: 'admin',
                            password: this.encryptPassword('password123'),
                            containerId: 'portainer_container',
                            favicon: ''
                        },
                        {
                            id: this.generateId(),
                            name: 'ChatGPT',
                            url: 'https://chat.openai.com',
                            section: 'ai',
                            favorite: true,
                            username: '',
                            password: '',
                            containerId: '',
                            favicon: ''
                        },
                        {
                            id: this.generateId(),
                            name: 'GitHub',
                            url: 'https://github.com',
                            section: 'tools',
                            favorite: false,
                            username: 'developer',
                            password: this.encryptPassword('github_token'),
                            containerId: '',
                            favicon: ''
                        },
                        {
                            id: this.generateId(),
                            name: 'Docker Hub',
                            url: 'https://hub.docker.com',
                            section: 'tools',
                            favorite: false,
                            username: '',
                            password: '',
                            containerId: '',
                            favicon: ''
                        },
                        {
                            id: this.generateId(),
                            name: 'Home Assistant',
                            url: 'http://localhost:8123',
                            section: 'lab',
                            favorite: true,
                            username: '',
                            password: '',
                            containerId: 'homeassistant',
                            favicon: ''
                        }
                    ]
                };
            }
            
            /**
             * Generate unique identifier for new items
             * @returns {string} Unique ID
             */
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            /**
             * Basic password encryption using configured passphrase
             * @param {string} password - Plain text password
             * @returns {string} Encrypted password
             */
            encryptPassword(password) {
                if (!password) return '';
                
                // Simple XOR encryption with passphrase
                const key = CONFIG.ENCRYPTION.passphrase;
                let encrypted = '';
                
                for (let i = 0; i < password.length; i++) {
                    const keyChar = key.charCodeAt(i % key.length);
                    const passChar = password.charCodeAt(i);
                    encrypted += String.fromCharCode(passChar ^ keyChar);
                }
                
                return btoa(encrypted); // Base64 encode the result
            }
            
            /**
             * Decrypt password using configured passphrase
             * @param {string} encryptedPassword - Encrypted password
             * @returns {string} Decrypted password
             */
            decryptPassword(encryptedPassword) {
                if (!encryptedPassword) return '';
                
                try {
                    const encrypted = atob(encryptedPassword);
                    const key = CONFIG.ENCRYPTION.passphrase;
                    let decrypted = '';
                    
                    for (let i = 0; i < encrypted.length; i++) {
                        const keyChar = key.charCodeAt(i % key.length);
                        const encChar = encrypted.charCodeAt(i);
                        decrypted += String.fromCharCode(encChar ^ keyChar);
                    }
                    
                    return decrypted;
                } catch (error) {
                    console.error('Failed to decrypt password:', error);
                    return '';
                }
            }
            
            /**
             * Setup global event listeners
             */
            setupEventListeners() {
                // Search functionality
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.searchQuery = e.target.value.toLowerCase();
                        this.render();
                    }, CONFIG.UI.searchDelay);
                });
                
                // Navigation menu handling
                document.addEventListener('click', (e) => {
                    const navLink = e.target.closest('.nav-link');
                    if (navLink) {
                        e.preventDefault();
                        this.handleNavigation(navLink.dataset.page, navLink.dataset.section);
                    }
                });
                
                // Context menu handling
                document.addEventListener('contextmenu', (e) => {
                    const card = e.target.closest('.link-card');
                    if (card) {
                        e.preventDefault();
                        this.showContextMenu(e, card.dataset.linkId);
                    }
                });
                
                // Close context menu on click outside
                document.addEventListener('click', () => {
                    this.hideContextMenu();
                });
                
                // Modal handling
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal-overlay')) {
                        this.hideModal();
                    }
                });
                
                // System theme change detection
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (this.theme === 'system') {
                        document.body.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                    }
                });
            }
            
            /**
             * Handle navigation between pages and sections
             * @param {string} page - Target page name
             * @param {string} section - Target section (optional)
             */
            handleNavigation(page, section = null) {
                // Update active nav item
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-page="${page}"]${section ? `[data-section="${section}"]` : ''}`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                this.currentPage = page;
                this.currentSection = section;
                this.editMode = false;
                
                this.render();
            }
            
            /**
             * Apply current theme to document
             */
            applyTheme() {
                const theme = this.theme === 'system' ? this.detectSystemTheme() : this.theme;
                document.body.setAttribute('data-theme', theme);
            }
            
            /**
             * Toggle between light and dark themes
             */
            toggleTheme() {
                this.theme = this.theme === 'dark' ? 'light' : 'dark';
                this.applyTheme();
                localStorage.setItem(`${CONFIG.APP_ID}-theme`, this.theme);
            }
            
            /**
             * Show notification to user
             * @param {string} message - Notification message
             * @param {string} type - Notification type (success, error, warning)
             */
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Trigger animation
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
            
            /**
             * Start polling Docker containers for status updates
             */
            startContainerPolling() {
                if (this.pollingInterval) {
                    clearInterval(this.pollingInterval);
                }
                
                // Initial poll
                this.pollContainerStatuses();
                
                // Set up recurring polling
                this.pollingInterval = setInterval(() => {
                    this.pollContainerStatuses();
                }, CONFIG.PORTAINER.pollingFrequency);
            }
            
            /**
             * Poll Portainer API for container statuses
             */
            async pollContainerStatuses() {
                const containersToCheck = this.data.links
                    .filter(link => link.containerId)
                    .map(link => link.containerId);
                
                if (containersToCheck.length === 0) return;
                
                try {
                    const response = await fetch(
                        `http://${CONFIG.PORTAINER.hostname}:${CONFIG.PORTAINER.port}/api/endpoints/${CONFIG.PORTAINER.endpoint}/docker/containers/json?all=true`,
                        {
                            headers: {
                                'X-API-Key': CONFIG.PORTAINER.apiKey,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (response.ok) {
                        const containers = await response.json();
                        
                        // Update container status map
                        containersToCheck.forEach(containerId => {
                            const container = containers.find(c => 
                                c.Names.some(name => name.includes(containerId)) || 
                                c.Id.startsWith(containerId)
                            );
                            
                            if (container) {
                                this.containerStatuses.set(containerId, container.State === 'running' ? 'online' : 'offline');
                            } else {
                                this.containerStatuses.set(containerId, 'unknown');
                            }
                        });
                        
                        // Update UI if we're showing cards with containers
                        this.updateContainerStatusIndicators();
                    }
                } catch (error) {
                    console.error('Portainer API polling failed:', error);
                    // Set all containers to unknown status on error
                    containersToCheck.forEach(containerId => {
                        this.containerStatuses.set(containerId, 'unknown');
                    });
                }
            }
            
            /**
             * Update container status indicators in the UI
             */
            updateContainerStatusIndicators() {
                document.querySelectorAll('.link-card').forEach(card => {
                    const linkId = card.dataset.linkId;
                    const link = this.data.links.find(l => l.id === linkId);
                    
                    if (link && link.containerId) {
                        const statusIndicator = card.querySelector('.card-status');
                        const status = this.containerStatuses.get(link.containerId);
                        
                        if (statusIndicator) {
                            statusIndicator.className = 'card-status';
                            if (status === 'online') {
                                statusIndicator.classList.add('online');
                            } else if (status === 'offline') {
                                statusIndicator.classList.add('offline');
                            }
                        }
                    }
                });
            }
            
            /**
             * Main render function - updates the entire UI based on current state
             */
            render() {
                this.renderNavigation();
                this.renderContent();
                this.updateEditModeUI();
            }
            
            /**
             * Render navigation menu with sections
             */
            renderNavigation() {
                const sectionsMenu = document.getElementById('sectionsMenu');
                sectionsMenu.innerHTML = '';
                
                this.data.sections.forEach(section => {
                    const li = document.createElement('li');
                    li.className = 'nav-item';
                    li.innerHTML = `
                        <a href="#" class="nav-link" data-page="section" data-section="${section.id}">
                            <span class="nav-icon" style="background-color: ${section.color};">${section.icon}</span>
                            ${section.name}
                            ${this.sidebarEditMode ? `<button class="btn-icon" style="margin-left: auto; padding: 2px; font-size: 12px; color: var(--error-color);" onclick="app.deleteSection('${section.id}')" title="Delete Section">√ó</button>` : ''}
                        </a>
                    `;
                    sectionsMenu.appendChild(li);
                });
                
                this.updateSidebarEditUI();
            }
            
            /**
             * Update sidebar edit mode UI elements
             */
            updateSidebarEditUI() {
                const editBtn = document.getElementById('editSidebarBtn');
                const addBtn = document.getElementById('addSectionBtn');
                
                if (this.sidebarEditMode) {
                    editBtn.textContent = '‚úì';
                    editBtn.title = 'Done Editing';
                    addBtn.classList.remove('hidden');
                } else {
                    editBtn.textContent = '‚úèÔ∏è';
                    editBtn.title = 'Edit Sections';
                    addBtn.classList.add('hidden');
                }
            }
            
            /**
             * Toggle sidebar edit mode
             */
            toggleSidebarEdit() {
                this.sidebarEditMode = !this.sidebarEditMode;
                this.renderNavigation();
            }
            
            /**
             * Delete section with confirmation
             * @param {string} sectionId - Section ID to delete
             */
            deleteSection(sectionId) {
                const section = this.data.sections.find(s => s.id === sectionId);
                if (!section) return;
                
                const linksInSection = this.data.links.filter(link => link.section === sectionId);
                
                let confirmMessage = `Are you sure you want to delete the "${section.name}" section?`;
                if (linksInSection.length > 0) {
                    confirmMessage += `\n\nThis will also delete ${linksInSection.length} link(s) in this section.`;
                }
                
                if (confirm(confirmMessage)) {
                    // Remove section
                    this.data.sections = this.data.sections.filter(s => s.id !== sectionId);
                    
                    // Remove links in this section
                    this.data.links = this.data.links.filter(link => link.section !== sectionId);
                    
                    // If currently viewing deleted section, go to favorites
                    if (this.currentSection === sectionId) {
                        this.handleNavigation('favorites');
                    }
                    
                    this.saveData();
                    this.render();
                    this.showNotification(`Section "${section.name}" deleted successfully`, 'success');
                }
            }
            
            /**
             * Render main content area based on current page
             */
            renderContent() {
                const pageContent = document.getElementById('pageContent');
                
                switch (this.currentPage) {
                    case 'favorites':
                        this.renderFavorites(pageContent);
                        break;
                    case 'section':
                        this.renderSection(pageContent);
                        break;
                    case 'sitemap':
                        this.renderSitemap(pageContent);
                        break;
                    default:
                        this.renderFavorites(pageContent);
                }
            }
            
            /**
             * Render favorites page with starred links
             * @param {HTMLElement} container - Container element
             */
            renderFavorites(container) {
                const favoriteLinks = this.data.links.filter(link => 
                    link.favorite && this.matchesSearch(link)
                );
                
                container.innerHTML = `
                    <div class="mb-4">
                        <h2 style="font-size: 28px; font-weight: 600; margin-bottom: 8px;">Favorites</h2>
                        <p style="color: var(--text-secondary);">Quick access to your most important links</p>
                    </div>
                    <div class="cards-grid">
                        ${favoriteLinks.map(link => this.renderLinkCard(link)).join('')}
                    </div>
                `;
            }
            
            /**
             * Render section page with links from specific section
             * @param {HTMLElement} container - Container element
             */
            renderSection(container) {
                const section = this.data.sections.find(s => s.id === this.currentSection);
                const sectionLinks = this.data.links.filter(link => 
                    link.section === this.currentSection && this.matchesSearch(link)
                );
                
                if (!section) {
                    container.innerHTML = '<div class="text-center">Section not found</div>';
                    return;
                }
                
                container.innerHTML = `
                    <div class="mb-4">
                        <h2 style="font-size: 28px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                            <span style="background-color: ${section.color}; padding: 8px; border-radius: 8px; font-size: 20px;">${section.icon}</span>
                            ${section.name}
                        </h2>
                    </div>
                    <div class="cards-grid">
                        ${sectionLinks.map(link => this.renderLinkCard(link)).join('')}
                        ${this.editMode ? '<div class="link-card" style="border: 2px dashed var(--border-color); display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="app.showAddLinkModal()"><div style="text-align: center; color: var(--text-secondary);"><div style="font-size: 24px; margin-bottom: 8px;">+</div><div>Add New Link</div></div></div>' : ''}
                    </div>
                `;
            }
            
            /**
             * Render sitemap page with all links organized by section
             * @param {HTMLElement} container - Container element
             */
            renderSitemap(container) {
                const filteredLinks = this.data.links.filter(link => this.matchesSearch(link));
                const linksBySection = {};
                
                // Group links by section
                filteredLinks.forEach(link => {
                    if (!linksBySection[link.section]) {
                        linksBySection[link.section] = [];
                    }
                    linksBySection[link.section].push(link);
                });
                
                let sitemapHTML = `
                    <div class="mb-4">
                        <h2 style="font-size: 28px; font-weight: 600; margin-bottom: 8px;">Sitemap</h2>
                        <p style="color: var(--text-secondary);">Complete overview of all your links</p>
                    </div>
                `;
                
                // Render each section
                this.data.sections.forEach(section => {
                    const sectionLinks = linksBySection[section.id] || [];
                    if (sectionLinks.length > 0) {
                        sitemapHTML += `
                            <div class="sitemap-section">
                                <div class="sitemap-section-header">
                                    <span class="sitemap-section-icon" style="background-color: ${section.color};">${section.icon}</span>
                                    ${section.name}
                                </div>
                                <div class="sitemap-links">
                                    ${sectionLinks.map(link => `
                                        <a href="${link.url}" target="_blank" class="sitemap-link ${link.favorite ? 'favorite' : ''}">
                                            ${link.name}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                });
                
                container.innerHTML = sitemapHTML;
            }
            
            /**
             * Render individual link card
             * @param {Object} link - Link data object
             * @returns {string} HTML string for link card
             */
            renderLinkCard(link) {
                const containerStatus = this.containerStatuses.get(link.containerId) || '';
                const isExpanded = this.expandedCards.has(link.id);
                
                return `
                    <div class="link-card" data-link-id="${link.id}" onclick="app.handleCardClick('${link.id}')">
                        <div class="card-header">
                            <div class="card-favicon">
                                ${link.favicon ? `<img src="${link.favicon}" alt="" style="width: 24px; height: 24px; border-radius: 4px;">` : link.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="card-title">${link.name}</div>
                            ${link.containerId ? `<div class="card-status ${containerStatus}"></div>` : ''}
                            ${link.favorite ? '<span class="favorite-star">‚≠ê</span>' : ''}
                        </div>
                        
                        ${!this.editMode && (this.currentPage !== 'favorites' && this.currentPage !== 'sitemap') ? `
                            ${(link.url || link.username || link.containerId) ? `
                                <button class="card-expand-btn" onclick="event.stopPropagation(); app.toggleCardExpansion('${link.id}')">
                                    ${isExpanded ? '‚ñ≤ Less' : '‚ñº More'}
                                </button>
                                <div class="card-expanded-content ${isExpanded ? 'show' : ''}">
                                    ${link.url ? `
                                        <div class="card-info-row">
                                            <span class="card-info-label">URL:</span>
                                            <div style="display: flex; align-items: center; gap: 4px;">
                                                <span class="card-info-value">${link.url}</span>
                                                <button class="card-info-btn" onclick="event.stopPropagation(); app.copyToClipboard('${link.url}')" title="Copy URL">üìã</button>
                                            </div>
                                        </div>
                                    ` : ''}
                                    ${link.username ? `
                                        <div class="card-info-row">
                                            <span class="card-info-label">Username:</span>
                                            <div class="card-info-actions">
                                                <span class="card-info-value">${link.username}</span>
                                                <button class="card-info-btn" onclick="event.stopPropagation(); app.copyToClipboard('${link.username}')" title="Copy Username">üìã</button>
                                            </div>
                                        </div>
                                    ` : ''}
                                    ${link.containerId ? `
                                        <div class="card-info-row">
                                            <span class="card-info-label">Container:</span>
                                            <span class="card-info-value">${link.containerId}</span>
                                        </div>
                                    ` : ''}
                                    ${link.password ? `
                                        <div class="card-info-row">
                                            <span class="card-info-label">Password:</span>
                                            <div class="card-info-actions">
                                                <span class="card-info-value" id="password-${link.id}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                                                <button class="card-info-btn" onclick="event.stopPropagation(); app.togglePasswordVisibility('${link.id}')" title="Show/Hide Password">üëÅÔ∏è</button>
                                                <button class="card-info-btn" onclick="event.stopPropagation(); app.copyPassword('${link.id}')" title="Copy Password">üìã</button>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                        ` : ''}
                        
                        ${this.currentPage === 'favorites' ? `
                            <div class="card-url">${link.url}</div>
                        ` : ''}
                        
                        ${this.editMode ? `
                            <div class="card-expanded">
                                <div class="card-field">
                                    <label>Name</label>
                                    <input type="text" value="${link.name}" onchange="app.updateLink('${link.id}', 'name', this.value)">
                                </div>
                                <div class="card-field">
                                    <label>URL</label>
                                    <input type="url" value="${link.url}" onchange="app.updateLink('${link.id}', 'url', this.value)">
                                </div>
                                <div class="card-field">
                                    <label>Username</label>
                                    <input type="text" value="${link.username}" onchange="app.updateLink('${link.id}', 'username', this.value)">
                                </div>
                                <div class="card-field">
                                    <label>Password</label>
                                    <input type="password" value="${this.decryptPassword(link.password)}" onchange="app.updateLink('${link.id}', 'password', this.value)">
                                </div>
                                <div class="card-field">
                                    <label>Container ID</label>
                                    <input type="text" value="${link.containerId}" onchange="app.updateLink('${link.id}', 'containerId', this.value)">
                                </div>
                                <div class="card-field">
                                    <label>Favicon URL</label>
                                    <input type="url" value="${link.favicon}" onchange="app.updateLink('${link.id}', 'favicon', this.value)">
                                </div>
                                <div class="form-checkbox">
                                    <input type="checkbox" class="checkbox" ${link.favorite ? 'checked' : ''} onchange="app.updateLink('${link.id}', 'favorite', this.checked)">
                                    <label>Favorite</label>
                                </div>
                                <div style="margin-top: 16px; display: flex; gap: 8px;">
                                    <button class="btn btn-primary" onclick="app.saveLink('${link.id}')">Save</button>
                                    <button class="btn btn-secondary" onclick="app.deleteLink('${link.id}')">Delete</button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            /**
             * Toggle card expansion state
             * @param {string} linkId - Link ID to toggle
             */
            toggleCardExpansion(linkId) {
                if (this.expandedCards.has(linkId)) {
                    this.expandedCards.delete(linkId);
                } else {
                    this.expandedCards.add(linkId);
                }
                this.render();
            }
            
            /**
             * Check if link matches current search query
             * @param {Object} link - Link object to check
             * @returns {boolean} Whether link matches search
             */
            matchesSearch(link) {
                if (!this.searchQuery) return true;
                
                const searchFields = [link.name, link.url, link.username].join(' ').toLowerCase();
                return searchFields.includes(this.searchQuery);
            }
            
            /**
             * Update edit mode UI elements
             */
            updateEditModeUI() {
                const editBtn = document.getElementById('editModeBtn');
                const addBtn = document.getElementById('addLinkBtn');
                
                if (this.editMode) {
                    editBtn.textContent = 'Done';
                    editBtn.classList.remove('btn-secondary');
                    editBtn.classList.add('btn-primary');
                    addBtn.classList.remove('hidden');
                } else {
                    editBtn.textContent = 'Edit';
                    editBtn.classList.remove('btn-primary');
                    editBtn.classList.add('btn-secondary');
                    addBtn.classList.add('hidden');
                }
            }
            
            /**
             * Handle card click events
             * @param {string} linkId - ID of clicked link
             */
            handleCardClick(linkId) {
                if (this.editMode) return;
                
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    window.open(link.url, '_blank');
                }
            }
            
            /**
             * Toggle edit mode on/off
             */
            toggleEditMode() {
                this.editMode = !this.editMode;
                this.render();
            }
            
            /**
             * Update link property
             * @param {string} linkId - Link ID
             * @param {string} field - Field name to update
             * @param {any} value - New value
             */
            updateLink(linkId, field, value) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    if (field === 'password') {
                        link[field] = this.encryptPassword(value);
                    } else {
                        link[field] = value;
                    }
                }
            }
            
            /**
             * Save link changes
             * @param {string} linkId - Link ID to save
             */
            saveLink(linkId) {
                this.saveData();
                this.showNotification('Link saved successfully', 'success');
            }
            
            /**
             * Delete link
             * @param {string} linkId - Link ID to delete
             */
            deleteLink(linkId) {
                if (confirm('Are you sure you want to delete this link?')) {
                    this.data.links = this.data.links.filter(l => l.id !== linkId);
                    this.saveData();
                    this.render();
                    this.showNotification('Link deleted successfully', 'success');
                }
            }
            
            /**
             * Show context menu for link card
             * @param {Event} event - Context menu event
             * @param {string} linkId - Link ID
             */
            showContextMenu(event, linkId) {
                this.hideContextMenu();
                
                const contextMenu = document.createElement('div');
                contextMenu.className = 'context-menu';
                contextMenu.innerHTML = `
                    <div class="context-menu-item" onclick="app.editLink('${linkId}')">Edit</div>
                    <div class="context-menu-item" onclick="app.copyLinkUrl('${linkId}')">Copy URL</div>
                    <div class="context-menu-item" onclick="app.toggleFavorite('${linkId}')">Toggle Favorite</div>
                    <div class="context-menu-item" onclick="app.deleteLink('${linkId}')">Delete</div>
                `;
                
                contextMenu.style.left = event.pageX + 'px';
                contextMenu.style.top = event.pageY + 'px';
                
                document.body.appendChild(contextMenu);
                
                // Store reference for cleanup
                this.currentContextMenu = contextMenu;
            }
            
            /**
             * Hide context menu
             */
            hideContextMenu() {
                if (this.currentContextMenu) {
                    this.currentContextMenu.remove();
                    this.currentContextMenu = null;
                }
            }
            
            /**
             * Copy text to clipboard
             * @param {string} text - Text to copy
             */
            async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    this.showNotification('Copied to clipboard', 'success');
                } catch (error) {
                    console.error('Failed to copy to clipboard:', error);
                    this.showNotification('Failed to copy to clipboard', 'error');
                }
            }
            
            /**
             * Toggle password visibility in expanded card
             * @param {string} linkId - Link ID
             */
            togglePasswordVisibility(linkId) {
                const passwordElement = document.getElementById(`password-${linkId}`);
                const link = this.data.links.find(l => l.id === linkId);
                
                if (passwordElement && link) {
                    if (passwordElement.textContent === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                        passwordElement.textContent = this.decryptPassword(link.password);
                    } else {
                        passwordElement.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    }
                }
            }
            
            /**
             * Toggle favorite status of link
             * @param {string} linkId - Link ID
             */
            
            /**
             * Copy link URL to clipboard (for context menu)
             * @param {string} linkId - Link ID
             */
            async copyLinkUrl(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    await this.copyToClipboard(link.url);
                }
                this.hideContextMenu();
            }
            toggleFavorite(linkId) {
                const link = this.data.links.find(l => l.id === linkId);
                if (link) {
                    link.favorite = !link.favorite;
                    this.saveData();
                    this.render();
                    this.showNotification(`Link ${link.favorite ? 'added to' : 'removed from'} favorites`, 'success');
                }
                this.hideContextMenu();
            }
            
            /**
             * Show modal for adding new link
             */
            showAddLinkModal() {
                const modal = this.createModal('Add New Link', `
                    <form id="addLinkForm">
                        <div class="form-group">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-input" name="name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">URL *</label>
                            <input type="url" class="form-input" name="url" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Section</label>
                            <select class="form-input" name="section">
                                ${this.data.sections.map(section => 
                                    `<option value="${section.id}" ${section.id === this.currentSection ? 'selected' : ''}>${section.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-input" name="username">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" name="password">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Container ID</label>
                            <input type="text" class="form-input" name="containerId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Favicon URL</label>
                            <input type="url" class="form-input" name="favicon">
                        </div>
                        <div class="form-group">
                            <div class="form-checkbox">
                                <input type="checkbox" class="checkbox" name="favorite">
                                <label>Add to favorites</label>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="submit" class="btn btn-primary">Add Link</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideModal()">Cancel</button>
                        </div>
                    </form>
                `);
                
                document.getElementById('addLinkForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAddLink(new FormData(e.target));
                });
            }
            
            /**
             * Handle adding new link
             * @param {FormData} formData - Form data from add link modal
             */
            handleAddLink(formData) {
                const newLink = {
                    id: this.generateId(),
                    name: formData.get('name'),
                    url: this.validateUrl(formData.get('url')),
                    section: formData.get('section') || this.currentSection || this.data.sections[0].id,
                    username: formData.get('username') || '',
                    password: this.encryptPassword(formData.get('password') || ''),
                    containerId: formData.get('containerId') || '',
                    favicon: formData.get('favicon') || '',
                    favorite: formData.has('favorite')
                };
                
                this.data.links.push(newLink);
                this.saveData();
                this.render();
                this.hideModal();
                this.showNotification('Link added successfully', 'success');
            }
            
            /**
             * Validate and format URL
             * @param {string} url - URL to validate
             * @returns {string} Validated URL
             */
            validateUrl(url) {
                if (!url) return '';
                
                // Add protocol if missing
                if (!url.match(/^https?:\/\//)) {
                    url = 'https://' + url;
                }
                
                try {
                    new URL(url);
                    return url;
                } catch (error) {
                    throw new Error('Invalid URL format');
                }
            }
            
            /**
             * Show modal for adding new section
             */
            showAddSectionModal() {
                const modal = this.createModal('Add New Section', `
                    <form id="addSectionForm">
                        <div class="form-group">
                            <label class="form-label">Section Name *</label>
                            <input type="text" class="form-input" name="name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Icon (Emoji)</label>
                            <input type="text" class="form-input" name="icon" placeholder="üîß" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Color</label>
                            <input type="color" class="form-input" name="color" value="#3B82F6">
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="submit" class="btn btn-primary">Add Section</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideModal()">Cancel</button>
                        </div>
                    </form>
                `);
                
                document.getElementById('addSectionForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAddSection(new FormData(e.target));
                });
            }
            
            /**
             * Handle adding new section
             * @param {FormData} formData - Form data from add section modal
             */
            handleAddSection(formData) {
                const newSection = {
                    id: this.generateId(),
                    name: formData.get('name'),
                    icon: formData.get('icon') || 'üìÅ',
                    color: formData.get('color') || '#3B82F6'
                };
                
                this.data.sections.push(newSection);
                this.saveData();
                this.render();
                this.hideModal();
                this.showNotification('Section added successfully', 'success');
            }
            
            /**
             * Show settings modal
             */
            showSettingsModal() {
                const modal = this.createModal('Settings', `
                    <div class="form-group">
                        <label class="form-label">Theme</label>
                        <select class="form-input" onchange="app.changeTheme(this.value)">
                            <option value="light" ${this.theme === 'light' ? 'selected' : ''}>Light</option>
                            <option value="dark" ${this.theme === 'dark' ? 'selected' : ''}>Dark</option>
                            <option value="system" ${this.theme === 'system' ? 'selected' : ''}>System</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Data Management</label>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="app.exportData()">Export Data</button>
                            <button class="btn btn-secondary" onclick="app.importData()">Import Data</button>
                            <button class="btn btn-secondary" onclick="app.clearData()" style="color: var(--error-color);">Clear All Data</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Application Info</label>
                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.5;">
                            <div>Version: ${CONFIG.SITE_INFO.version}</div>
                            <div>Author: ${CONFIG.SITE_INFO.author}</div>
                            <div>Copyright: ¬© ${CONFIG.SITE_INFO.copyright}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <button class="btn btn-secondary" onclick="app.hideModal()">Close</button>
                    </div>
                `);
            }
            
            /**
             * Change application theme
             * @param {string} theme - New theme value
             */
            changeTheme(theme) {
                this.theme = theme;
                this.applyTheme();
                localStorage.setItem(`${CONFIG.APP_ID}-theme`, theme);
            }
            
            /**
             * Export application data as JSON file
             */
            exportData() {
                try {
                    const dataStr = JSON.stringify(this.data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `homepage-backup-${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                    URL.revokeObjectURL(url);
                    this.showNotification('Data exported successfully', 'success');
                } catch (error) {
                    console.error('Export failed:', error);
                    this.showNotification('Export failed', 'error');
                }
            }
            
            /**
             * Import application data from JSON file
             */
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            // Validate data structure
                            if (importedData.sections && importedData.links) {
                                this.data = importedData;
                                this.saveData();
                                this.render();
                                this.hideModal();
                                this.showNotification('Data imported successfully', 'success');
                            } else {
                                throw new Error('Invalid data format');
                            }
                        } catch (error) {
                            console.error('Import failed:', error);
                            this.showNotification('Import failed - invalid file format', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            }
            
            /**
             * Clear all application data
             */
            clearData() {
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    localStorage.removeItem(`${CONFIG.APP_ID}-data`);
                    this.data = this.getSampleData();
                    this.render();
                    this.hideModal();
                    this.showNotification('All data cleared', 'warning');
                }
            }
            
            /**
             * Create and show modal
             * @param {string} title - Modal title
             * @param {string} content - Modal content HTML
             * @returns {HTMLElement} Modal element
             */
            createModal(title, content) {
                this.hideModal();
                
                const overlay = document.createElement('div');
                overlay.className = 'modal-overlay';
                overlay.innerHTML = `
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">${title}</h3>
                            <button class="modal-close" onclick="app.hideModal()">&times;</button>
                        </div>
                        <div class="modal-content">
                            ${content}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                this.currentModal = overlay;
                
                return overlay;
            }
            
            /**
             * Hide current modal
             */
            hideModal() {
                if (this.currentModal) {
                    this.currentModal.remove();
                    this.currentModal = null;
                }
            }
        }
        
        /**
         * Global Functions
         * Functions that need to be accessible from HTML onclick handlers
         */
        
        // Initialize application
        let app;
        
        document.addEventListener('DOMContentLoaded', () => {
            app = new AppState();
        });
        
        // Global helper functions for HTML onclick handlers
        function toggleTheme() {
            app.toggleTheme();
        }
        
        function toggleEditMode() {
            app.toggleEditMode();
        }
        
        function showAddLinkModal() {
            app.showAddLinkModal();
        }
        
        function showAddSectionModal() {
            app.showAddSectionModal();
        }
        
        function showSettingsModal() {
            app.showSettingsModal();
        }
        
        function toggleSidebarEdit() {
            app.toggleSidebarEdit();
        }
        
        /**
         * PWA Support
         * Progressive Web App functionality when PWA=true parameter is present
         */
        if (new URLSearchParams(window.location.search).get('PWA') === 'true') {
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(() => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            }
            
            // Add to home screen prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button or notification
                const installBtn = document.createElement('button');
                installBtn.textContent = 'Install App';
                installBtn.className = 'btn btn-primary';
                installBtn.style.position = 'fixed';
                installBtn.style.bottom = '20px';
                installBtn.style.right = '20px';
                installBtn.style.zIndex = '2000';
                
                installBtn.onclick = async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        deferredPrompt = null;
                        installBtn.remove();
                    }
                };
                
                document.body.appendChild(installBtn);
            });
        }
        
    </script>
    
    <!-- PWA Manifest (when PWA=true) -->
    <script>
        // Generate manifest.json dynamically
        if (new URLSearchParams(window.location.search).get('PWA') === 'true') {
            const manifest = {
                name: "Personal Homepage",
                short_name: "Homepage",
                description: "AI-Generated Personal Homepage with OpenWebUI Design",
                start_url: "./",
                display: "standalone",
                background_color: "#1A1A1A",
                theme_color: "#3B82F6",
                icons: [
                    {
                        src: "data:image/svg+xml;base64," + btoa(`
                            <svg width="192" height="192" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg">
                                <rect width="192" height="192" fill="#3B82F6" rx="24"/>
                                <path d="M48 96L96 48L144 96L96 144Z" fill="white" opacity="0.9"/>
                                <circle cx="96" cy="96" r="16" fill="white"/>
                                <rect x="72" y="72" width="48" height="4" fill="white" opacity="0.7"/>
                                <rect x="72" y="116" width="48" height="4" fill="white" opacity="0.7"/>
                                <rect x="72" y="82" width="32" height="2" fill="white" opacity="0.5"/>
                                <rect x="72" y="106" width="32" height="2" fill="white" opacity="0.5"/>
                            </svg>
                        `),
                        sizes: "192x192",
                        type: "image/svg+xml"
                    },
                    {
                        src: "data:image/svg+xml;base64," + btoa(`
                            <svg width="512" height="512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <rect width="512" height="512" fill="#3B82F6" rx="64"/>
                                <path d="M128 256L256 128L384 256L256 384Z" fill="white" opacity="0.9"/>
                                <circle cx="256" cy="256" r="40" fill="white"/>
                                <rect x="192" y="192" width="128" height="8" fill="white" opacity="0.7"/>
                                <rect x="192" y="312" width="128" height="8" fill="white" opacity="0.7"/>
                                <rect x="192" y="208" width="96" height="4" fill="white" opacity="0.5"/>
                                <rect x="192" y="296" width="96" height="4" fill="white" opacity="0.5"/>
                            </svg>
                        `),
                        sizes: "512x512",
                        type: "image/svg+xml"
                    }
                ]
            };
            
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            document.querySelector('link[rel="manifest"]').href = manifestUrl;
        }
    </script>
    
    <!-- Base64 Encoded Assets and Data -->
    <!-- AI-GENERATED: Large data blocks placed at end for maintainability -->
    
    <script>
        /**
         * Service Worker Code (for PWA functionality)
         * This would typically be in a separate sw.js file
         */
        const SW_CODE = `
            const CACHE_NAME = 'homepage-v1';
            const urlsToCache = ['./'];
            
            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => cache.addAll(urlsToCache))
                );
            });
            
            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => response || fetch(event.request))
                );
            });
        `;
        
        // Create service worker blob URL if PWA mode is enabled
        if (new URLSearchParams(window.location.search).get('PWA') === 'true') {
            const swBlob = new Blob([SW_CODE], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);
            
            // Override the service worker registration to use blob URL
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('Service Worker registered from blob'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            }
        }
    </script>
    
    <!-- Keyboard Shortcuts -->
    <script>
        /**
         * Keyboard Shortcuts Handler
         * Provides quick keyboard access to common functions
         */
        document.addEventListener('keydown', (e) => {
            // Only handle shortcuts when not typing in input fields
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            switch (e.key) {
                case '/':
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                    break;
                case 'e':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        app.toggleEditMode();
                    }
                    break;
                case 'n':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        if (app.editMode) {
                            app.showAddLinkModal();
                        }
                    }
                    break;
                case 'Escape':
                    app.hideModal();
                    app.hideContextMenu();
                    break;
                case 't':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        app.toggleTheme();
                    }
                    break;
            }
        });
    </script>
    
    <!-- Analytics and Monitoring (Optional) -->
    <script>
        /**
         * Simple Analytics Tracking
         * Tracks basic usage patterns for optimization
         */
        class Analytics {
            constructor() {
                this.sessionStart = Date.now();
                this.events = [];
                this.maxEvents = 100;
            }
            
            /**
             * Track user interaction event
             * @param {string} action - Action performed
             * @param {Object} metadata - Additional event data
             */
            track(action, metadata = {}) {
                const event = {
                    timestamp: Date.now(),
                    action,
                    metadata,
                    sessionDuration: Date.now() - this.sessionStart
                };
                
                this.events.push(event);
                
                // Keep only recent events
                if (this.events.length > this.maxEvents) {
                    this.events = this.events.slice(-this.maxEvents);
                }
                
                // Log to console for debugging
                console.log('Analytics:', event);
            }
            
            /**
             * Get usage statistics
             * @returns {Object} Usage statistics
             */
            getStats() {
                return {
                    sessionDuration: Date.now() - this.sessionStart,
                    totalEvents: this.events.length,
                    mostCommonActions: this.getMostCommonActions(),
                    averageSessionTime: this.getAverageSessionTime()
                };
            }
            
            getMostCommonActions() {
                const actionCounts = {};
                this.events.forEach(event => {
                    actionCounts[event.action] = (actionCounts[event.action] || 0) + 1;
                });
                return Object.entries(actionCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
            }
            
            getAverageSessionTime() {
                if (this.events.length === 0) return 0;
                return this.events.reduce((sum, event) => sum + event.sessionDuration, 0) / this.events.length;
            }
        }
        
        // Initialize analytics
        const analytics = new Analytics();
        
        // Track page loads and navigation
        document.addEventListener('DOMContentLoaded', () => {
            analytics.track('page_load', { 
                url: window.location.href,
                userAgent: navigator.userAgent.substring(0, 100)
            });
        });
        
        // Track clicks on navigation items
        document.addEventListener('click', (e) => {
            if (e.target.closest('.nav-link')) {
                analytics.track('navigation_click', {
                    page: e.target.closest('.nav-link').dataset.page,
                    section: e.target.closest('.nav-link').dataset.section
                });
            }
            
            if (e.target.closest('.link-card')) {
                analytics.track('link_click', {
                    editMode: app?.editMode || false
                });
            }
            
            if (e.target.closest('.btn')) {
                analytics.track('button_click', {
                    buttonText: e.target.textContent.trim()
                });
            }
        });
        
        // Track search usage
        document.addEventListener('input', (e) => {
            if (e.target.id === 'searchInput' && e.target.value.length > 2) {
                analytics.track('search_query', {
                    queryLength: e.target.value.length
                });
            }
        });
        
        // Track theme changes
        const originalToggleTheme = window.toggleTheme;
        window.toggleTheme = function() {
            analytics.track('theme_toggle', {
                newTheme: app?.theme || 'unknown'
            });
            return originalToggleTheme?.apply(this, arguments);
        };
    </script>
    
    <!-- Error Handling and Recovery -->
    <script>
        /**
         * Global Error Handler
         * Catches and logs application errors for debugging
         */
        window.addEventListener('error', (e) => {
            console.error('Global error caught:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error
            });
            
            // Show user-friendly error message
            if (app && app.showNotification) {
                app.showNotification('An error occurred. Please refresh the page.', 'error');
            }
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            
            if (app && app.showNotification) {
                app.showNotification('A network error occurred. Please check your connection.', 'warning');
            }
        });
        
        /**
         * Data Recovery Functions
         * Helps recover from corrupted localStorage data
         */
        function attemptDataRecovery() {
            try {
                const backupKey = `${CONFIG.APP_ID}-data-backup`;
                const backup = localStorage.getItem(backupKey);
                
                if (backup) {
                    const backupData = JSON.parse(backup);
                    localStorage.setItem(`${CONFIG.APP_ID}-data`, backup);
                    console.log('Data recovered from backup');
                    return backupData;
                }
            } catch (error) {
                console.error('Data recovery failed:', error);
            }
            return null;
        }
        
        /**
         * Automatic Data Backup
         * Creates periodic backups of user data
         */
        setInterval(() => {
            if (app && app.data) {
                try {
                    const backupKey = `${CONFIG.APP_ID}-data-backup`;
                    localStorage.setItem(backupKey, JSON.stringify(app.data));
                } catch (error) {
                    console.error('Backup creation failed:', error);
                }
            }
        }, 5 * 60 * 1000); // Backup every 5 minutes
    </script>
    
    <!-- Performance Monitoring -->
    <script>
        /**
         * Performance Monitor
         * Tracks application performance metrics
         */
        class PerformanceMonitor {
            constructor() {
                this.metrics = {
                    loadTime: 0,
                    renderTime: 0,
                    searchTime: 0,
                    apiResponseTime: 0
                };
                
                this.init();
            }
            
            init() {
                // Measure initial load time
                window.addEventListener('load', () => {
                    this.metrics.loadTime = performance.now();
                    console.log('Page load time:', this.metrics.loadTime + 'ms');
                });
                
                // Monitor render performance
                this.monitorRenderPerformance();
            }
            
            monitorRenderPerformance() {
                const observer = new PerformanceObserver((list) => {
                    list.getEntries().forEach((entry) => {
                        if (entry.entryType === 'measure') {
                            console.log(`Performance: ${entry.name} took ${entry.duration}ms`);
                        }
                    });
                });
                
                observer.observe({ entryTypes: ['measure'] });
            }
            
            measureAsync(name, asyncFunction) {
                return async (...args) => {
                    const start = performance.now();
                    try {
                        const result = await asyncFunction.apply(this, args);
                        const duration = performance.now() - start;
                        performance.mark(`${name}-start`);
                        performance.mark(`${name}-end`);
                        performance.measure(name, `${name}-start`, `${name}-end`);
                        return result;
                    } catch (error) {
                        console.error(`Performance measurement failed for ${name}:`, error);
                        throw error;
                    }
                };
            }
        }
        
        // Initialize performance monitoring
        const perfMonitor = new PerformanceMonitor();
    </script>
    
    <style>
        /* Additional Utility Styles */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Print Styles */
        @media print {
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
            .link-card { break-inside: avoid; }
            .btn { display: none; }
        }
        
        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            
            .link-card {
                border-width: 2px;
            }
        }
        
        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus Indicators for Accessibility */
        .btn:focus,
        .form-input:focus,
        .nav-link:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
        
        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile-specific styles */
        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .link-card {
                padding: 16px;
            }
            
            .modal {
                margin: 16px;
                width: calc(100% - 32px);
            }
        }
    </style>
</body>
</html>
                